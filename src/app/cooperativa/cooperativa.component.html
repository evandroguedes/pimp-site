<div class="container-fluid container_style">

    <div class="container" [hidden]="!loading">
        <div class="loading-box">
            <div class="loading">Loading&#8230;</div>
            <p class="loading-message">{{ loadingMessage }}</p>
        </div>
    </div>

    <div class="container container-extra-padding">
        <div class="row" *ngIf="!showMap">
            <div class="col-md-12">
                <h1>Cadastro de Coperativa</h1>
                <p>Com este formulário você irá cadastrar uma nova cooperativa no nosso aplicativo. Preencha tudo com muito carinho e atenção, este perfil será o cartão de visita da cooperativa :)</p>
            </div>
        </div>
        <hr *ngIf="!showMap">
        <form (ngSubmit)="save()" #catadorForm="ngForm" enctype="multipart/form-data">
            <!-- FIRST STEP -->
            <div *ngIf="!showMap">
                <div class="row">
                    <div class="col-md-12">
                        <div class="form-group">
                            <input type="text" class="form-control" id="name" name="name" placeholder="Nome da cooperativa" [(ngModel)]="cooperativa.name"
                                maxlength="60" required>
                        </div>

                        <div class="form-group">
                            <input type="text" id="datepicker" class="form-control" name="founded_in" placeholder="Data de fundação" [textMask]="{mask: masks.date}" [(ngModel)]="cooperativa.founded_in">
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" id="email" name="email" placeholder="E-mail" [(ngModel)]="cooperativa.email" maxlength="100"
                                required>
                        </div>

                        <div class="form-group">
                            <div class="form-group">
                                <input type="number" class="form-control" id="how_many_cooperators" name="how_many_cooperators" placeholder="Número de cooperados"
                                    [(ngModel)]="cooperativa.how_many_cooperators" required>
                            </div>
                        </div>
        
                        <div class="form-group">
                            <textarea class="form-control" id="history" rows="5" name="history" maxlength="600" placeholder="História da cooperativa" required [(ngModel)]="cooperativa.history"></textarea>
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" id="phrase" name="phrase" placeholder="Frase marcante" required maxlength="200" [(ngModel)]="cooperativa.phrase">
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" id="phones0" name="phones0" [textMask]="{mask: masks.number}" placeholder="Telefone Principal" [(ngModel)]="cooperativa.phones[0].phone"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="whatsapp0">Esta linha tem WhatsApp?</label>
                            <select class="form-control" id="whatsapp0" name="whatsapp0" [(ngModel)]="cooperativa.phones[0].whatsapp">
                                <option value="1">Sim</option>
                                <option value="0">Não</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <input type="text" class="form-control" id="phones1" placeholder="Telefone para garantir" [textMask]="{mask: masks.number}" name="phones1" [(ngModel)]="cooperativa.phones[1].phone">
                        </div>
    
                        <div class="form-group">
                            <label for="whatsapp1">Esta linha tem WhatsApp?</label>
                            <select class="form-control" id="whatsapp1" name="whatsapp1" [(ngModel)]="cooperativa.phones[1].whatsapp">
                                <option value="1">Sim</option>
                                <option value="0">Não</option>
                            </select>
                        </div>
                    </div>
                </div>
                <hr>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="form-group">
                            <label>Adicionar foto principal</label>
                            <input type='file' class="filestyle col-md-12" data-input="false" (change)="readLogoURL($event);" />
                        </div>
                        <div class="form-group">
                            <label>Adicionar fotos da galeria</label>
                            <input type='file' class="filestyle col-md-12" data-input="false" (change)="readGalleryURL($event);" multiple/>
                        </div>
                    </div>
                </div>          
                <div class="row">
                    <div class="col-sm-4 col-md-2" *ngFor="let photo of cooperativa.photos" [hidden]="photo.delete && photo.delete == 1">
                        <div class="thumbnail">
                            <img [src]="getGallerySrc(photo)" class="gallery-photo">
                            <div class="caption">
                                <p>
                                    <a (click)="removeImageOnGallery(photo)" class="btn btn-danger" role="button">Delete</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>                
                
                <hr />
                <!-- PARCEIROS -->
                <div class="row">
                    <div class="col-md-12">
                        <h2>Galeria de parceiros</h2>
                        <div class="form-group">
                            <label>Logo</label>
                            <input type='file' 
                                    class="filestyle col-md-12" 
                                    data-input="false"
                                    id="parceiro-image-input"
                                    [disabled]="partnerLoading" 
                                    (change)="readPartnerURL($event);"/>
                        </div>
                        <div class="form-group">
                            <input type="text" class="form-control" id="parceiro-name" placeholder="Nome do parceiro" name="parceiro-name" [(ngModel)]="parceiro.name"
                                maxlength="60">
                        </div>
                        <p>
                            <a (click)="addPartner(parceiro)" class="btn btn-info" role="button">Adicionar</a>
                        </p>
                    </div>
                </div>  
                <div class="row">                
                    <div class="col-sm-4 col-md-2" *ngFor="let partner of cooperativa.partners" [hidden]="partner.delete && partner.delete == 1">
                        <div class="thumbnail">
                            <img [src]="getPartnerSrc(partner)" class="gallery-photo">
                            <div class="caption">
                                <h3>Parceiro #</h3>
                                <h4>{{ partner.name }}</h4>                              
                                <p>
                                    <a (click)="removePartner(partner)" class="btn btn-danger" role="button">Delete</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /PARCEIROS -->
                <hr />
                <!-- MATERIAIS -->
                <div class="row">
                    <div class="col-md-12">
                        <label>Selecione os materiais em que você trabalha:</label>
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-misturado.png" alt="Misturado" class="img-responsive img-material" (click)="selectMaterial('misturado')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('misturado') > -1 }" />
                        <input name="material[]" type="checkbox" value="'misturado'" [checked]="materialSelected.indexOf('misturado') > -1" (click)="selectMaterial('misturado')"
                        /> Misturado
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-lata.png" alt="Lata" class="img-responsive img-material" (click)="selectMaterial('lata')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('lata') > -1 }" />
                        <input name="material[]" type="checkbox" value="'lata'" [checked]="materialSelected.indexOf('lata') > -1" (click)="selectMaterial('lata')"
                        /> Lata
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-vidro.png" alt="Vidro" class="img-responsive img-material" (click)="selectMaterial('vidro')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('vidro') > -1 }" />
                        <input name="material[]" type="checkbox" value="'vidro'" [checked]="materialSelected.indexOf('vidro') > -1" (click)="selectMaterial('vidro')"
                        /> Vidro
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-papel.png" alt="papel" class="img-responsive img-material" (click)="selectMaterial('papel')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('papel') > -1 }" />
                        <input name="material[]" type="checkbox" value="'papel'" [checked]="materialSelected.indexOf('papel') > -1" (click)="selectMaterial('papel')"
                        /> Papel
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-plastico.png" alt="plastico" class="img-responsive img-material" (click)="selectMaterial('plastico')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('plastico') > -1 }" />
                        <input name="material[]" type="checkbox" value="'plastico'" [checked]="materialSelected.indexOf('plastico') > -1" (click)="selectMaterial('plastico')"
                        /> Plastico
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-metal.png" alt="metal" class="img-responsive img-material" (click)="selectMaterial('metal')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('metal') > -1 }" />
                        <input name="material[]" type="checkbox" value="'metal'" [checked]="materialSelected.indexOf('metal') > -1" (click)="selectMaterial('metal')"
                        /> Metal
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-oleo.png" alt="oleo" class="img-responsive img-material" (click)="selectMaterial('oleo')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('oleo') > -1 }" />
                        <input name="material[]" type="checkbox" value="'oleo'" [checked]="materialSelected.indexOf('oleo') > -1" (click)="selectMaterial('oleo')"
                        /> Óleo
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-eletronico.png" alt="eletronico" class="img-responsive img-material" (click)="selectMaterial('eletronico')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('eletronico') > -1 }" />
                        <input name="material[]" type="checkbox" value="'eletronico'" [checked]="materialSelected.indexOf('eletronico') > -1" (click)="selectMaterial('eletronico')"
                        /> Eletrônicos
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-bateria.png" alt="bateria" class="img-responsive img-material" (click)="selectMaterial('bateria')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('bateria') > -1 }" />
                        <input name="material[]" type="checkbox" value="'bateria'" [checked]="materialSelected.indexOf('bateria') > -1" (click)="selectMaterial('bateria')"
                        /> Bateria
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-moveis.png" alt="moveis" class="img-responsive img-material" (click)="selectMaterial('moveis')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('moveis') > -1 }" />
                        <input name="material[]" type="checkbox" value="'moveis'" [checked]="materialSelected.indexOf('moveis') > -1" (click)="selectMaterial('moveis')"
                        /> Móveis
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-entulho.png" alt="entulho" class="img-responsive img-material" (click)="selectMaterial('entulho')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('entulho') > -1 }" />
                        <input name="material[]" type="checkbox" value="'entulho'" [checked]="materialSelected.indexOf('entulho') > -1" (click)="selectMaterial('entulho')"
                        /> Entulho
                    </div>

                    <div class="col-md-2 col-sm-2 col-xs-4 text-center">
                        <img src="assets/img/materiais/Icones_materiais-poda.png" alt="outros" class="img-responsive img-material" (click)="selectMaterial('outros')"
                            [ngClass]="{'img-selected': materialSelected.indexOf('outros') > -1 }" />
                        <input name="material[]" type="checkbox" value="'outros'" [checked]="materialSelected.indexOf('outros') > -1" (click)="selectMaterial('outros')"
                        /> Outros
                    </div>
                </div>
                <!--/ MATERIAIS -->
            </div>
            <!-- /FIRST STEP -->

            <!-- SECOND STEP (MAP) -->
            <div *ngIf="showMap">

                <div class="row">
                    <div class="col-lg-12 map-title-container">
                        <h4>LOCAL DE TRABALHO</h4>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12 map-container">
                        <agm-map
                            [latitude]="markLat"
                            [longitude]="markLng"
                            [zoom]="zoom"
                            [streetViewControl]="false"
                            [scrollwheel]="false"
                            (mapClick)="onClickMap($event)"
                            style="height: 315px">
                            <agm-marker
                                [latitude]="markLat"
                                [longitude]="markLng"
                                [markerDraggable]="true"
                                [iconUrl]=""
                                (dragEnd)="onMoveMark($event)"></agm-marker>
                        </agm-map>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div>
                            <div style="width: 28%; float: left; margin-right: 2%;">
                                    <div class="form-group">
                                        <input type="text" 
                                                class="form-control" 
                                                name="state"
                                                placeholder="Estado" 
                                                [(ngModel)]="coperativa.state"
                                                (focusout)="addressFocusOut()"
                                                maxlength="128">
                                    </div> 
                                </div>    
                            <div style="width: 28%; float: left; margin-right: 2%;">
                                    <div class="form-group">
                                        <input type="text" 
                                                class="form-control" 
                                                placeholder="Cidade" 
                                                id="city" 
                                                name="city"
                                                [(ngModel)]="coperativa.city"
                                                required
                                                (focusout)="addressFocusOut()"
                                                maxlength="64">
                                    </div>
                                </div>
                            <div style="width: 40%; float: left">
                                <div class="form-group">
                                    <input type="text" 
                                            class="form-control" 
                                            placeholder="Bairro" 
                                            id="address_region" 
                                            name="address_region"
                                            [(ngModel)]="coperativa.address_region"
                                            (focusout)="addressFocusOut()"
                                            maxlength="128">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="input-col-left">
                                <div class="form-group">
                                    <input type="text" 
                                            class="form-control" 
                                            placeholder="Rua" 
                                            required
                                            id="address_base" 
                                            name="address_base"
                                            [(ngModel)]="coperativa.address_base"
                                            (focusout)="addressFocusOut()"
                                            maxlength="500">
                                </div>
                            </div>
                            <div class="input-col-right">
                                <div class="form-group">
                                    <input type="number" 
                                            class="form-control" 
                                            placeholder="nº"
                                            id="number" 
                                            name="number"
                                            [(ngModel)]="coperativa.number">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- /SECOND STEP (MAP) -->

            <!-- BUTTONS -->
            <div class="row" *ngIf="!showMap">
                <div class="col-xs-6">
                    <button type="button" (click)="goHome()" class="btn cancel-button btn-danger">
                        Cancelar
                    </button>
                </div>
                <div class="col-xs-6">
                    <a (click)="toggleMap()" class="btn btn-success primary-button">
                        Avançar
                    </a>
                </div>
            </div>

            <div class="row" *ngIf="showMap">
                    <div class="col-xs-6">
                        <button type="button" (click)="goHome()" class="btn cancel-button btn-danger">
                            Cancelar
                        </button>
                    </div>
                    <div class="col-xs-6">
                        <a (click)="toggleMap()" class="btn primary-button btn-success">
                            Confirmar
                        </a>
                    </div>
                </div>

            <!-- /BUTTONS -->
        </form>

    </div>

</div>